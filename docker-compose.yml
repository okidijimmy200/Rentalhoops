version: '3.9'

services: 
    rentalhoops-api:
        restart: always
        build: 
            context: .
            dockerfile: Dockerfile.server.dev
        container_name: rentalhoops-api
        volumes: 
            - /home/app/node_modules
            - .:/home/app
        ports: 
            - 8000:8000
        depends_on: 
            - mongodb
        environment: 
            NODE_ENV: ${NODE_ENV}
            MONGO_URI: mongodb://${MONGO_ROOT_USERNAME}:${MONGO_ROOT_PASSWORD}@mongodb
        networks: 
            - rentalhoops-api

    mongodb:
        image: mongo
        restart: always
        ports: 
            - 27018:27017
        environment: 
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
        volumes: 
            - mongodb-data:/data/db
        networks: 
            - rentalhoops-api
    
    client:
        restart: always
        build: 
            context: ./client
            dockerfile: Dockerfile.client.dev
        container_name: rentalhoops-client
        volumes: 
            - /home/app/node_modules
            - ./client:/home/app
        ports: 
            - 3000:3000
        depends_on: 
            - rentalhoops-api
        networks: 
            - rentalhoops-api

    nginx:
        restart: always
        depends_on:
            - rentalhoops-api
            - client
        build:
            context: ./nginx
            dockerfile: Dockerfile.nginx.dev
        ports:
            - 8880:80
        networks:
            - rentalhoops-api

networks:
    rentalhoops-api:
        driver: bridge
    
volumes:
    mongodb-data:
        driver: local